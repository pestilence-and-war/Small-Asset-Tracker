<li id="ingredient-{{ ingredient.id }}" class="ingredient-item">
    <div class="ingredient-display">
        <span>{{ ingredient.name }} - <strong>{{ '%.2f'|format(ingredient.display_quantity) }}</strong></span>

        <form class="unit-selector-form">
            <input type="hidden" name="view_name" value="{{ view_name or 'pantry' }}">
            <select name="unit"
                    hx-post="/update_ingredient_display_unit/{{ ingredient.id }}"
                    hx-trigger="change"
                    hx-target="#ingredient-{{ ingredient.id }}"
                    hx-swap="outerHTML"
                    hx-include="[name='view_name']">
                {% for unit in ingredient.compatible_units %}
                <option value="{{ unit }}" {% if unit == ingredient.display_unit %}selected{% endif %}>
                    {{ unit }}
                </option>
                {% endfor %}
            </select>
        </form>

        {% if ingredient.conversion_error %}
            <span class="error-icon" title="Conversion not available. Using base unit.">!</span>
        {% endif %}

        {% if show_edit_buttons %}
        <div>
            <button hx-get="/edit_ingredient_form/{{ ingredient.id }}?view_name={{ view_name or 'pantry' }}" hx-target="#ingredient-{{ ingredient.id }}" hx-swap="innerHTML" class="edit-btn">
                Edit
            </button>
        </div>
        {% endif %}
    </div>
</li>
